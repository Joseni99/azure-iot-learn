# Hands-on LAB: Costs, logs and alerts

## Study Case

In today's dynamic business landscape, organizations are increasingly relying on cloud-based infrastructure to support their operations. As our company continues to scale and innovate, the adoption of cloud technologies becomes imperative to drive efficiency, flexibility, and cost-effectiveness. To further streamline our IT operations and ensure optimal performance, we propose deploying virtual machines (VMs) in Microsoft Azure while emphasizing cost management, logging, and proactive monitoring.

**Objective:** The primary objective of this initiative is to deploy virtual machines in Azure to support our diverse workloads while optimizing costs, enhancing logging capabilities, and establishing robust monitoring and alerting mechanisms. By leveraging Azure's advanced features and services, we aim to improve operational efficiency, minimize downtime, and drive business continuity.

**Exercise:** In order to do a first test in Azure before migrating the VMs, managers want to see a PoC of how they can track costs, logs and establishing proactive monitorization for alarms and so on.

The requirements are:

1. Get familiarized with the cost and logs panels.

2. Deploy a VM to simulate a charge.

3. Create an alarm to notify via email when the machine is over 80% of usage.

## Part 1: Costs and logs

1. In order to review the costs we have to enter in the suscription asociated to those resources, if you remember every resource have to have a subscription.
   
   If we open the Azure for Students suscription and go to the over overview we can see quickly which are our charges and where they are distributed.
   
   <p align="center">
   <img src="img\13%20(2).png" title="" alt="13 (2).png" width="646">
   </p>

2. The Azure Activity Log is a service provided by Microsoft Azure that records operational events related to resources in your Azure subscription. It serves as a comprehensive audit trail of actions taken by various users, applications, or Azure services within your Azure environment.
   
   <p align="center">
   <img src="img\13%20(3).png" title="" alt="13 (3).png" width="648">
   </p>

3. Azure Monitor Logs is a service provided by Microsoft Azure that allows you to collect and analyze log and telemetry data generated by your Azure resources and applications. It helps you gain insights into the performance, usage, and health of your applications and infrastructure.
   
   <p align="center">
   <img src="img\13%20(4).png" title="" alt="13 (4).png" width="649">
   </p>

4. Azure Metrics provide insights into the performance, health, and usage of your applications and infrastructure within the Azure cloud environment.
   
   <p align="center">
   <img src="img\13%20(5).png" title="" alt="13 (5).png" width="646">
   </p>

5. Alerts refer to notifications triggered based on predefined conditions or thresholds set on metrics or activity logs.
   
   <p align="center">
   <img src="img\13%20(6).png" title="" alt="13 (6).png" width="647">
   </p>
   ## Part 2: Setting an Alert in Azure

6. Before proceding to create an alarm, let's deploy first a VM like we have learned before:
- Resource group: EU-resource-group

- Name: eu-vm3

- Region: Free to choose

- Availability Zone: ree to choose

- Image: Ubuntu 20.04

- Size: Standard B1s, 1 vcpu and 1GiB
2. Once finished go to Monitor Alerts an click on create a new alert:
   
   <p align="center">
   <img src="img\13%20(6).png" title="" alt="13 (6).png" width="647">
   </p>

3. Select the resource group to monitor and in this case where the VM is. Set the scope to Virtual Machines and the location where the VM is located.
   
   <p align="center">
   <img src="img\13%20(7).png" title="" alt="13 (7).png" width="540">
   </p>

4. Set the condition to trigger the alert:
   
   -    Aggregation type: Maximum
   
   -    Operator: Greater than
   
   -    Threshold Value: 80
   
   <p align="center">
   <img title="" src="img\13%20(9).png" alt="13 (9).png" width="657">
   </p>

5. In actions, create a action group called alarm_group.
   
   <p align="center">
   <img title="" src="img\13.png" alt="13.png" width="666">
   </p>
   
   <p align="center">
   <img src="img\13%20(10).png" title="" alt="13 (10).png" width="657">
   </p>

6. When creating the action group go to Notifications and set up an Email/SMS/Push/Voice and set your personal email.
   
   <p align="center">
   <img src="img\13%20(11).png" title="" alt="13 (11).png" width="669">
   </p>

7. Finish the alarm configuration giving it a name and a severity.
   
   <p align="center">
   <img title="" src="img\13%20(8).png" alt="13 (8).png" width="657">
   </p>

8. You should receive a message like this in your email if the action group is created correctly:
   
   <p align="center">
   <img title="" src="img\13%20(12).png" alt="13 (12).png" width="382">
   </p>

9. Now to the fun part, let's trigger our alarm and simulate a load in our Virtual Machine:
   
   ```
   sudo apt update
   ```
   
   ```
   sudo apt-get install stress
   ```
   
   ```
   stress --cpu 1
   ```

10. After a few minutes we should get a notification like this due to the high load in the VM:
    
    <p align="center">
    <img title="" src="img\13%20(13).png" alt="13 (13).png" width="364">
    </p>
    Stop the load with Ctrl+C and wait a few minutes.

11. And the Alert should be solved!
    
    <p align="center">
    <img title="" src="img\13%20(14).png" alt="13 (14).png" width="364">
    </p>
